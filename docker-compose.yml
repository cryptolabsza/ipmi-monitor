version: '3.8'

services:
  ipmi-monitor:
    image: ipmi-monitor:latest
    # Or build locally:
    # build: .
    container_name: ipmi-monitor
    restart: unless-stopped
    ports:
      - "5000:5000"
    environment:
      # Application branding
      - APP_NAME=IPMI Monitor  # Customize for your organization
      
      # IPMI/BMC credentials
      - IPMI_USER=admin
      - IPMI_PASS=your-ipmi-password  # CHANGE THIS!
      - IPMI_PASS_NVIDIA=your-16-char-password  # NVIDIA DGX/HGX need 16 chars
      # - NVIDIA_BMCS=192.168.1.98,192.168.1.99  # Comma-separated NVIDIA BMC IPs (optional)
      
      # Collection intervals
      - POLL_INTERVAL=300  # 5 minutes for SEL events
      - SENSOR_POLL_MULTIPLIER=1  # Collect sensors every N cycles
      
      # Admin authentication - CHANGE THESE!
      - ADMIN_USER=admin
      - ADMIN_PASS=changeme  # IMPORTANT: Change in production!
      - SECRET_KEY=your-secret-key-change-me  # For session encryption
    volumes:
      - ipmi_data:/app/instance  # SQLite database location
    networks:
      - monitoring
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    # For IPMI access, need host network or proper routing
    # Uncomment below if BMC IPs are not directly accessible
    # network_mode: host

volumes:
  ipmi_data:

networks:
  monitoring:
    external: true  # Use existing monitoring network
    # Or create a new network:
    # driver: bridge
